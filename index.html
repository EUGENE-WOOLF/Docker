<!DOCTYPE html>
<html>
<head>
  <title>Mini Project App</title>
</head>
<body>
  <h1>Mini Project Tracker</h1>

  <h2>Add User</h2>
  <input id="userName" placeholder="Name">
  <input id="userEmail" placeholder="Email">
  <button onclick="addUser()">Add User</button>

  <h2>Add Project</h2>
  <input id="projectTitle" placeholder="Title">
  <input id="projectDesc" placeholder="Description">
  <select id="projectOwner"></select>
  <button onclick="addProject()">Add Project</button>

  <h2>Projects</h2>
  <ul id="projectList"></ul>

<script>
async function fetchUsers() {
  const res = await fetch('/users');
  const users = await res.json();
  const select = document.getElementById('projectOwner');
  select.innerHTML = '';
  users.forEach(u => {
    const opt = document.createElement('option');
    opt.value = u._id;
    opt.textContent = u.name;
    select.appendChild(opt);
  });
}

async function fetchProjects() {
  const res = await fetch('/projects');
  const projects = await res.json();
  const list = document.getElementById('projectList');
  list.innerHTML = '';
  projects.forEach(p => {
    const li = document.createElement('li');
    li.textContent = `${p.title} - ${p.description} (Owner: ${p.owner?.name || 'Unknown'})`;
    list.appendChild(li);
  });
}

async function addUser() {
  const name = document.getElementById('userName').value;
  const email = document.getElementById('userEmail').value;
  await fetch('/users', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({name,email}) });
  document.getElementById('userName').value='';
  document.getElementById('userEmail').value='';
  fetchUsers();
}

async function addProject() {
  const title = document.getElementById('projectTitle').value;
  const desc = document.getElementById('projectDesc').value;
  const owner = document.getElementById('projectOwner').value;
  await fetch('/projects', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({title,description:desc,owner}) });
  document.getElementById('projectTitle').value='';
  document.getElementById('projectDesc').value='';
  fetchProjects();
}

fetchUsers();
fetchProjects();
</script>
</body>
</html>
